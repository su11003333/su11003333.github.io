(this.webpackJsonpchatify=this.webpackJsonpchatify||[]).push([[7],{234:function(e,t,n){"use strict";var r,a=n(243),o=n.n(a),c="http://34.80.98.184/",i=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_URL:"http://34.80.98.184",REACT_APP_WS_URL:"ws://34.80.98.184:5002",REACT_APP_TOKEN:"xZrvrD9NgrHv4sQxDqXWgrkSfH6XyMCRVwR6bp6NYMVFhRWKRvTYRPk7G4Eed5U4CvvWb5zVMPTvZWpw7vKHGAR68Kw68aNnEkTWvW6Rr5XgXw4W6r3w3cwptyf964MadvrWd4q87PB4hZzW4z4Vg4w8tcwUwyxugASv783H7sC348Hh7QuuXXWP3N7N6eH9hPSaXERAqgc79RmpsCyxMtNR9xcUTBX5G99fAyQ2CVHq5S2Kh6WqyeUyrFhhfPcb",REACT_APP_USER:"goodboy",REACT_APP_PWD:"IL0veVVeb#0109",REACT_APP_WS_MODE:"true",REACT_APP_DEBUG:"true"}).REACT_APP_PATCH_API_URL,s=sessionStorage.getItem("Token"),u=function(){return{headers:{Authorization:"Bearer ".concat(s)}}};t.a={getAccessToken:function(){return r},setAccessToken:function(e){r=e},login:function(e){var t="".concat(c,"Auth/SignIn");return o.a.post(t.replace("undefined",""),e)},registerWs:function(){console.log(s);var e="".concat(c,"Auth/RegisterWs");return o.a.get(e.replace("undefined",""),u())},sendMessage:function(e){var t="".concat(c,"notify/send");return o.a.post(t.replace("undefined",""),e,u())},sendBroadcast:function(e){var t="".concat(c,"notify/broadcast");return o.a.post(t.replace("undefined",""),e,u())},query:function(e){var t="".concat(c,"Summon/Call");return o.a.post(t.replace("undefined",""),e,u())},getSite:function(e){var t="".concat(c,"ui/GetSite");return o.a.get(t.replace("undefined",""),u())},getProvider:function(e){var t="".concat(c,"ui/GetProvider");return o.a.get(t.replace("undefined",""),u())},patchBooks:function(e){var t="".concat(i,"api/Patch");return o.a.post(t.replace("undefined",""),e,u())}}},237:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(81);var a=n(94);function o(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},324:function(e,t,n){"use strict";n.r(t);var r,a,o=n(237),c=n(14),i=n(1),s=n.n(i),u=n(240),l=n.n(u),d=n(241),f=n(23),m=n(209),b=n(242),p=n(4),v=s.a.memo((function(e){var t=e.name,n=(e.namesCount,e.setNamesCount),r=e.allSettings,a=r.nameColor,o=r.speed,s=r.colorType,u=r.fontSize,l=Object(i.useState)(!0),d=Object(c.a)(l,2),f=d[0],v=d[1],h=Object(i.useMemo)((function(){return Object(b.random)(2e3,-2e3)}),[]),j=Object(i.useMemo)((function(){return Object(b.random)(2e3,-2e3)}),[]),S=Object(i.useMemo)((function(){return Object(b.random)(10,-10)}),[]),g=Object(i.useMemo)((function(){return Object(b.random)(360)}),[]),O=Object(m.a)((function(){return{root:{position:"absolute",opacity:.9,animation:"move ".concat(o,"s ease-out forwards"),height:"150px",width:"320px",animationDelay:"-0.2s",transform:"translate3d(".concat(h,"px, ").concat(j,"px, ").concat(S,"px) "),background:"transparent"},word:{animation:"bigtosmall ".concat(o,"s forwards"),fontSize:"".concat(u,"px"),color:"hsl(".concat("specific"===s?a.hsl[0]:g," , 70%, 50%)"),fontWeight:"bold"}}}))(),w=1e3*o||0;return Object(i.useEffect)((function(){return n((function(e){return e+1})),""===t&&v(!1),setTimeout((function(){v(!1)}),w),clearTimeout()}),[]),f?Object(p.jsx)("div",{className:O.root,children:Object(p.jsx)("div",{className:O.word,children:t})}):null})),h=n(46),j=n(234),S=void 0,g=!1,O=0,w=function(){if(S&&S.removeEventListener("message",y),clearTimeout(a),!g&&++O>2){clearInterval(r),r=void 0,T(j.a.getAccessToken());setTimeout((function(){r||(r=setInterval((function(){return x(3e3)}),6e3))}),6e3)}},x=function(e){g=!1,S&&S.readyState==WebSocket.OPEN&&(S.addEventListener("message",y),S.send('{"Type": 9}'),a=setTimeout((function(){return w()}),e)),S&&S.readyState==WebSocket.CLOSED&&w()},y=function(e){10==JSON.parse(e.data).Type&&(g=!0)},C=function(){g=!1,S&&S.readyState!=WebSocket.CLOSED&&S.close()},T=function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!S||!g){e.next=4;break}return e.abrupt("return",new Promise((function(e){return e(g)})));case 4:C();case 5:return e.prev=5,e.next=8,j.a.registerWs();case 8:if(t=e.sent,n=t.data.toString()){e.next=12;break}return e.abrupt("return");case 12:return S=new WebSocket("".concat("ws://34.80.98.184:5002/").concat(n).replace("undefined","")),o=setTimeout((function(){x(5e3),clearTimeout(o)}),500),e.abrupt("return",new Promise((function(e){var t=0,n=setInterval((function(){(++t>=50||g)&&(clearInterval(n),clearTimeout(o),S.removeEventListener("message",y),clearTimeout(a),O=0,g&&(clearInterval(r),r=setInterval((function(){return x(3e3)}),6e3)),e(g))}),100)})));case 17:if(e.prev=17,e.t0=e.catch(5),S){e.next=21;break}throw e.t0;case 21:case"end":return e.stop()}}),e,null,[[5,17]])})));return function(){return e.apply(this,arguments)}}(),E={closeConnection:function(){C(),S=void 0},openConnection:T,currentConnection:function(){return S}},k=n(252);var A=function(e){var t=e.mainEvent,n=e.number,r=e.allSettings,a=e.namesCount,s=e.setNamesCount,u=e.webSocket,m=(e.enterOrNot,Object(i.useState)([])),b=Object(c.a)(m,2),S=b[0],g=b[1],O=function(){var e=Object(d.a)(l.a.mark((function e(){var t,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={username:"goodboy",password:"IL0veVVeb#0109"},e.prev=1,e.next=4,j.a.login(t);case 4:n=e.sent,e.prev=5,Object(k.a)(n.data),e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(5),console.log("\u767b\u5165\u5931\u6557"),e.abrupt("return");case 13:r=n.data,sessionStorage.setItem("Token",r),j.a.setAccessToken(r),e.next=20;break;case 18:e.prev=18,e.t1=e.catch(1);case 20:case"end":return e.stop()}}),e,null,[[1,18],[5,9]])})));return function(){return e.apply(this,arguments)}}(),w=sessionStorage.getItem("Token");return Object(i.useEffect)((function(){!0===u&&O()}),[]),!0===u&&w&&E.openConnection().then((function(e){if(e){var t=E.currentConnection();t.readyState!=WebSocket.OPEN||(t.onmessage=function(e){var t=JSON.parse(e.data);if(2==t.Type){var n=t.RequestId.toString(),r=t.Result.toString();r&&g((function(e){var t=e.filter((function(e){return e.time>Date.parse(new Date)-8e3}));return[].concat(Object(o.a)(t),[{name:r,id:n,time:Date.parse(new Date)}])}))}})}else console.log("else"),E.closeConnection()})).catch((function(e){console.log(e)})),Object(i.useEffect)((function(){t&&!1===u&&(console.log("not webSocket"),f.b.collection("events").doc(t).collection("names_".concat(n)).where("created_at",">",function(){var e=new Date;return e.setSeconds(e.getSeconds()-10),h.a.firestore.Timestamp.fromDate(e)}()).onSnapshot((function(e){g(e.docs.map((function(e){return{name:e.data().name,id:e.id}})))})))}),[t,u]),Object(p.jsx)(p.Fragment,{children:S.map((function(e){return Object(p.jsx)(v,{name:e.name,allSettings:r,namesCount:a,setNamesCount:s},e.id)}))})},P=n(41),N=Object(m.a)((function(e){var t;return{videoResponsive:(t={overflow:"hidden",paddingBottom:"56.25%",position:"relative",height:0},Object(P.a)(t,"position","absolute"),Object(P.a)(t,"minHeight","50vh"),Object(P.a)(t,"left","50%"),Object(P.a)(t,"top","50%"),Object(P.a)(t,"transform","translate(-50%,-50%)"),Object(P.a)(t,"zIndex","0"),Object(P.a)(t,"width","100%"),t),iframe:{left:"50%",top:"50%",transform:"translate(-50%,-50%)",minHeight:"100%",width:"130%",position:"absolute"}}})),_=function(e){var t=e.embedId,n=N();return Object(p.jsx)("div",{className:n.videoResponsive,children:Object(p.jsx)("iframe",{className:n.iframe,width:"853",height:"480",src:"https://www.youtube.com/embed/".concat(t,"?feature=oembed&controls=0&mute=1&autoplay=1&loop=1&playlist=").concat(t),frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,title:"Embedded youtube"})})},R=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return n};t.default=function(e){var t=e.mainEvent,n=e.allSettings,r=Object(i.useState)(0),a=Object(c.a)(r,2),s=a[0],u=a[1],l=n.entranceVideo,d=n.predictPopulation,f=n.testMode,b=n.webSocket,h=n.testNameNumber,j=n.titleFontSize,S=n.subtitleFontSize,g=n.namesFly,O=parseInt(d)||1e3,w=function(){var e=4e3/O*s-4e3;return e>1||!g?"0":e},x="0"!==w(),y=Object(m.a)((function(){return{root:{position:"absolute",transform:"translate3d(0 ,0 ,".concat(w(),"px)"),display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column",transition:"all 0.2s",animation:"".concat(x?"":"tilt 6s linear infinite")},bg:{position:"absolute",backgroundImage:"url(".concat(n.entranceBg,")"),width:"100%",minHeight:"100%",backgroundPosition:"center,center",backgroundRepeat:"no-repeat",backgroundSize:"cover"},subtitle:{color:"".concat(x?n.subtitleColor?n.subtitleColor.css.backgroundColor:"#FFFFFF":"transparent"),letterSpacing:"5px",textShadow:"0 0 1px var(--color),0 0 50px var(--color),0 0 100px var(--color)",animation:"".concat(x?"":" colorSwap 10s linear infinite"),fontSize:"".concat(S,"px")},title:{color:"".concat(x?n.titleColor?n.titleColor.css.backgroundColor:"#FFFFFF":"transparent"),textShadow:"0 0 1px var(--color),0 0 50px var(--color),0 0 100px var(--color)",animation:"".concat(x?"":" colorSwap 10s linear infinite"),fontSize:"".concat(j,"px"),letterSpacing:"10px"},video:{position:"absolute",width:"100%",minHeight:"50vh",left:"50%",top:"50%",transform:"translate(-50%,-50%)"}}}))();return Object(p.jsxs)("div",{className:"entrance--container",children:[Object(p.jsx)("div",{className:y.bg}),l&&Object(p.jsx)(_,{embedId:l}),Object(p.jsx)("div",{className:"entrance--title__container",children:Object(p.jsxs)("div",{className:y.root,children:[Object(p.jsx)("div",{className:y.title,children:""!==n.entranceTitle?n.entranceTitle:""}),Object(p.jsx)("div",{className:y.subtitle,children:""!==n.entranceSubTitle?n.entranceSubTitle:""})]})}),Object(p.jsx)("div",{className:"entrance--wrapper",children:Object(p.jsxs)("div",{className:"bubble--wrapper",children:[x&&!f&&!0===b&&Object(p.jsx)(A,{allSettings:n,webSocket:b,mainEvent:t,namesCount:s,setNamesCount:u,nameEnter:x}),x&&!f&&!1===b&&Object(o.a)(Array(20)).map((function(e,r){return Object(p.jsx)(A,{number:r,allSettings:n,webSocket:b,mainEvent:t,namesCount:s,setNamesCount:u,nameEnter:x},r)})),f&&Object(o.a)(Array(+h)).map((function(e,r){return Object(i.createElement)(v,{allSettings:n,mainEvent:t,namesCount:s,setNamesCount:u,nameEnter:x,name:R(5),key:r,number:r})}))]})}),Object(p.jsx)("span",{className:"namesCount_container",children:s})]})}}}]);
//# sourceMappingURL=7.1690bdd1.chunk.js.map